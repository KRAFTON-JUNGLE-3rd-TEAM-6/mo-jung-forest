<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <style>
        /* compatibility for smaller devices */
        body {
            min-width: 360px;
        }
        
        /* compatibility for tablet devices */
        @media (min-width: 820px) {
            .container{
                max-width: 820px;
            }
        }

        .progress {
            background-color: transparent; /* 배경 색상을 투명으로 설정 */
        }

        .profile-thumbnail {
            height: 3em; /* Adjust the height as needed */
            width: 3em; /* Ensure the width matches the height to create a square */
            border-radius: 50%; /* Create an elliptical shape (50% radius for a perfect ellipse) */
            overflow: hidden;
        }

        .profile-thumbnail img {
            object-fit: cover; /* Crop the image to fill the container */
            width: 100%; /* Ensure the image takes up the full width of the container */
            height: 100%; /* Ensure the image takes up the full height of the container */
        }


    </style>
    <script>
        $(document).ready(function () {
            // $("#feed-box").empty();
            showFeed();
        });
        
        function showFeed(){
            $.ajax({
                    type: "GET",
                    url: "/test",
                    data: {},
                    success: function (response) {
                        if(result == "success")
                        {
                            let data = response['data'];
                            for(let i = 0; i <data.length;i++){
                                let mode = data['mode'];
                                if(mode == "MESSAGE"){
                                    let recepient = data['recepient'];
                                    let content = data['content'];
                                    //let reactionId = data['reactionId'];
                                    //let reactions = data['reactions'];  // list
                                    makeMessageCard(recepient,content);
                                }
                                else if(mode == "VOTE"){
                                    let title = data['title'];
                                    let options = data['options']; // list
                                    let optionCounts = data['optionCounts']; // list
                                    let optionId = data['optionId']; // 0인 경우는 투표 안한 경우
                                    if(optionId == 0){
                                        makeBeforeVoteCard(title,options);
                                    }
                                    else{
                                        makeAfterVoteCard(title,options,optionCounts,optionId);
                                    }
                                }       
                            }

                            // 선택된 페이지 (defalut : 1)
                            let page = response['page'];

                        }


                       
                    }
                })
        }

        function makeMessageCard(recepient, content) {
            let tempHtml = `<div class="card mb-3 shadow-lg bg-light" style="height: 216.45px;">
                        <div class="card-body d-flex flex-column justify-content-center">
                        <h2 class="text-muted">익명의 사용자가 <b>${recepient}</b>에게 메세지를 남겼습니다. </h2>
                            <p>"</p>
                            <pre><h5>   ${content} <h5></pre>
                            <p>"</p>
                        </div>
                    </div>`;
            $("#feed-box").append(tempHtml);
        }

        function makeBeforeVoteCard(title,options){

            let tempHtml = `<h2 class="text-muted">익명의 사용자가 투표를 남겼습니다:<strong>"${title}"</strong> </h2>`;
            for(let i = 0; i < options.length;i++){
                let subHtml =`<div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="exampleCheckbox">
                    <label class="form-check-label" for="exampleCheckbox">
                        ${options[i]}
                    </label>
                </div>`;

                tempHtml += subHtml;
            }

            $("#feed-box").append(tempHtml);
        }

        function makeAfterVoteCard(title,options,optionCounts,optionId){
            let tempHtml = `<h2 class="text-muted">익명의 사용자가 투표를 남겼습니다:<strong>"${title}"</strong> </h2>`;
            let max = 0;
            // for(let i = 0; i < optionCounts.length;i++){
            //     if(optionCounts)
            // }

            for(let i = 0; i < options.length;i++){
                let subHtml =`<div class="progress">
                    <div class="text-muted">${options[i]}</div>
                    <div class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="{{ 50 }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>`;

                tempHtml += subHtml;
            }

            $("#feed-box").append(tempHtml);
        }
        
    </script>
</head>
<body>
    <!-- top container -->
    <div id="mypage-box" class="container">
        <div class="d-flex justify-content-end">
            <div class="profile-thumbnail">
                <img src="https://images.contentstack.io/v3/assets/blt370612131b6e0756/blt50837d6fac883c81/60107b5c0839e910126d7603/Teemo_Skin01.jpg" alt="Profile Image" class="img-thumbnail rounded-circle">
            </div>
            <p class="mt-2 text-muted">김상우님 안녕하세요</p>
        </div>
    </div>
    <div id="button-box" class="container">
    </div>
    <!-- feed container -->
    <div id="feed-title" class="container d-flex justify-content-end pt-4 pb-2">
        <h1 class="text-success col-9">모동숲 피드</h1>
        <div>
            <button type="button" class="btn btn-outline-success">메세지 작성</button>
            <button type="button" class="btn btn-outline-success">투표 제안</button>
        </div>
    </div>
    </div>
    <div id="feed-box" class="container">
        <div class="card mb-3 shadow-lg bg-light" style="height: 216.45px;">
            <div class="card-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-right-dots-fill" viewBox="0 0 16 16">
                    <path d="M16 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h9.586a1 1 0 0 1 .707.293l2.853 2.853a.5.5 0 0 0 .854-.353V2zM5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                </svg>
                익명의 사용자가 <b>김상우</b>에게 메세지를 남겼습니다
            </div>
            <div class="card-body d-flex flex-column justify-content-center">
                잘생겼어요
            </div>
        </div>
        <div class="card mb-3 shadow-lg bg-light" style="height: 216.45px;">
            <div class="card-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-mailbox2-flag" viewBox="0 0 16 16">
                    <path d="M10.5 8.5V3.707l.854-.853A.5.5 0 0 0 11.5 2.5v-2A.5.5 0 0 0 11 0H9.5a.5.5 0 0 0-.5.5v8h1.5Z"/>
                    <path d="M4 3h4v1H6.646A3.99 3.99 0 0 1 8 7v6h7V7a3 3 0 0 0-3-3V3a4 4 0 0 1 4 4v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a4 4 0 0 1 4-4Zm.585 4.157C4.836 7.264 5 7.334 5 7a1 1 0 0 0-2 0c0 .334.164.264.415.157C3.58 7.087 3.782 7 4 7c.218 0 .42.086.585.157Z"/>
                </svg>
                익명의 사용자가 투표를 남겼습니다: <strong>"탕후루vs탕수육"</strong>
            </div>
            <div class="card-body d-flex flex-column justify-content-center">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="optionRadio">
                    <label class="form-check-label" for="optionRadio1">
                        탕후루
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="optionRadio">
                    <label class="form-check-label" for="optionRadio2">
                        탕수육
                    </label>
                </div>                
            </div>
        </div>
        <div class="card mb-3 shadow-lg bg-light" style="height: 216.45px;">
            <div class="card-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-mailbox2" viewBox="0 0 16 16">
                    <path d="M9 8.5h2.793l.853.854A.5.5 0 0 0 13 9.5h1a.5.5 0 0 0 .5-.5V8a.5.5 0 0 0-.5-.5H9v1z"/>
                    <path d="M12 3H4a4 4 0 0 0-4 4v6a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V7a4 4 0 0 0-4-4zM8 7a3.99 3.99 0 0 0-1.354-3H12a3 3 0 0 1 3 3v6H8V7zm-3.415.157C4.42 7.087 4.218 7 4 7c-.218 0-.42.086-.585.157C3.164 7.264 3 7.334 3 7a1 1 0 0 1 2 0c0 .334-.164.264-.415.157z"/>
                </svg>
                이미 투표하셨습니다: <strong>"탕후루vs탕수육"</strong>
            </div>
            <div class="card-body d-flex flex-column justify-content-center">
                <div id="vote-option">
                    <div class="text-muted">탕후루</div>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 25%;" aria-valuenow="{{ 25 }}" aria-valuemin="0" aria-valuemax="100">1표</div>
                    </div>
                </div>
                <div id="vote-option">
                    <div class="text-muted">탕수육</div>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 25%;" aria-valuenow="{{ 25 }}" aria-valuemin="0" aria-valuemax="100">1표</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- pagination container -->
    <div id="pagination-box" class="container">
        <h1>페이지네이션 예제</h1>
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="{{ url_for('index', page=1) }}">이전</a></li>
            {% for page_num in range(page, 5) %}
            <li class="page-item {% if page_num == current_page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('index', page=page_num) }}">{{ page_num }}</a>
            </li>
            {% endfor %}
            <li class="page-item"><a class="page-link" href="{{ url_for('index', page=total_pages) }}">다음</a></li>
        </ul>
    </div>
</body>
</html>